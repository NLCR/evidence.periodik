<VirtualHost *:8080>

    ServerName https://app.permonik.nkp.cz:443
    ServerAlias https://app.permonik-test.nkp.cz:443

    <Location /Shibboleth.sso>
        SetHandler shib
    </Location>

    <Location /api/auth/login/shibboleth>
        AuthType shibboleth
        Require shibboleth
        ShibRequestSetting requireSession 1
        ShibUseHeaders On

        RequestHeader set firstName "%{firstName}e" env=firstName
        RequestHeader set lastName "%{lastName}e" env=lastName
        RequestHeader set email "%{email}e" env=email
        RequestHeader set eduPersonScopedAffiliation "%{eduPersonScopedAffiliation}e" env=eduPersonScopedAffiliation
        RequestHeader set eppn "%{eppn}e" env=eppn

        ProxyPass http://permonik-api:8080/api/auth/login/shibboleth
        ProxyPassReverse http://permonik-api:8080/api/auth/login/shibboleth
    </Location>

    <Location /login/shibboleth>
        AuthType            shibboleth
        Require             shibboleth
        ShibRequestSetting  requireSession  1
        ShibUseHeaders On
    </Location>
</VirtualHost>
